# Two-Factor Authentication
2FA using something like Google Authenticator

## Requirements
* `composer require pragmarx/google2fa`
* `composer require bacon/bacon-qr-code`

## Database changes

### Table: users
Addition of two fields:
* `two_factor_enabled`: 0=no (default); 1=yes
* `two_factor_secret`: holds the 2FA secret

## Affected files (anticipated)
* `csb-accounts/*`
* admin dashboards (user management functions)
*

## Process
### During user registration
During registration, user is asked if they want to enable 2FA.
If they say "yes" then generate a QR code, have the user scan the code and enter the 2FA number generated by their app.
Only if it matches, update the `users` table to reflect `two_factor_enabled='1'` and `two_factor_secret` set to the secret.

### Enabling later
Allow a registered user to enable 2FA.
Generate a QR code, have the user scan the code and enter the 2FA number generated by their app.
Only if it matches, update the `users` table to reflect `two_factor_enabled='1'` and `two_factor_secret` set to the secret.

### Disabling 2FA
Allow a registered user to disable 2FA if `two_factor_enabled='1'`.
User must confirm password to disable 2FA.
Update `users` table to reflect `two_factor_enabled='0'` and `two_factor_secret=NULL`.

### During rescue process
_**NB:** This process needs to be discussed._

During the rescue process, if 2FA is enabled for the user, require them to enter it.
If they do not have their 2FA generator, generate a one-time 2FA with a long lifespan and email to the user.
If it matches, disable 2FA and prompt user to re-enable it.
